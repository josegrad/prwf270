var bw;var bh;var dw=440;var dh=270;var cw;var ch;var fh;var iw;var ih;var il;var cf;var od;var old;var otd;var bl;var bt;var oc;var ocw;var och;var hw;var hf;var hh;var ds;var mnh='240px';var omn='mn';var ch0='';var ch1;var as=new Array('Spd','Club','Diamd','Heart');var ai=new Array('A',2,3,4,5,6,7,8,9,10,'J','Q','K');var p=new Array(new Player('You'),new Player('Computer 1'),new Player('Computer 2'),new Player('Computer 3'));var d=new Array(4);var u=new Array(52);var t=new Array(52);var cs=0;var ci=-1;var pt=0;if(window.innerWidth<480){bw=320;bh=240;dw=320;dh=240;ch=40;fh=8;iw=6;ih=7;il=2;cf=8;od=50;oc=8;ocw=60;och=3;hw=180;hf=8;hh=20;hp=10;ds=3;tf0=48;mnh='200px';gs('chint').padding='1px';gs('bmn').width='30px'}else if(window.innerWidth<640){bw=480;bh=320;ch=60;fh=10;iw=7;ih=8;il=3;cf=10;od=70;oc=13;ocw=80;och=8;hw=220;hf=10;hh=32;hp=12;ds=4;tf0=56}else if(window.innerWidth<810){bw=640;bh=480;ch=80;fh=12;iw=9;ih=11;il=5;cf=11;od=100;oc=18;ocw=120;och=10;hw=260;hf=12;hh=38;hp=14;ds=6;tf0=64}else{bw=800;bh=600;ch=100;fh=14;iw=10;ih=12;il=7;cf=12;od=130;oc=23;ocw=160;och=20;hw=320;hf=14;hh=44;hp=16;ds=7;tf0=64}cw=0.75*ch;old=Math.round(window.innerWidth-(od*3+cw))/2;otd=Math.round(window.innerHeight-ch-10)/2;bl=Math.round(window.innerWidth-bw)/2;bt=Math.round(window.innerHeight-bh)/2;ps('base',bl,bt,bw,bh);gs('mn').height=mnh;sdlg('mn');sf('tt0',tf0);ps('hint',(bl+ocw+5),null,(bw-2*ocw-10));var sh=gl('sh');if(sh==null||sh=='')sh=1;gi('sh').checked=(sh==1);var a=gl('sgd');if(a==null||a=='')gi('lg').className='dsb';sf('bmn',hf);var pw=22*oc;p[0].x1=(bw-pw)/2+bl-1;p[0].y1=bt+bh-och-ch-1;p[0].x2=p[0].x1+pw+1;p[0].y2=p[0].y1+ch+1;p[1].x1=bl+och-1;p[1].y1=bt+hp+och-1;p[1].x2=p[1].x1+cw+1;p[1].y2=p[1].y1+pw+1;p[2].x1=(bw-pw)/2+bl-1;p[2].y1=bt+och-1;p[2].x2=p[2].x1+pw+1;p[2].y2=p[2].y1+ch+1;p[3].x1=bl+bw-och-cw-1;p[3].y1=bt+och-1;p[3].x2=p[3].x1+cw+1;p[3].y2=p[3].y1+pw+1;ps('r0',p[0].x1,p[0].y1,pw+2,ch+2);ps('r1',p[1].x1,p[1].y1,cw+2,pw+2);ps('r2',p[2].x1,p[2].y1,pw+2,ch+2);ps('r3',p[3].x1,p[3].y1,cw+2,pw+2);ps('p0',p[0].x1,p[0].y1-hp-5,cw-2,hp);sf('p0',hf-2);ps('p1',p[1].x1,p[1].y1-hp-5,cw-2,hp);sf('p1',hf-2);ps('p2',p[2].x2-cw-1,p[2].y2+2,cw-2,hp);sf('p2',hf-2);ps('p3',p[3].x1,p[3].y2+2,cw-2,hp);sf('p3',hf-2);for(var i=0;i<4;i++){d[i]=new Deck(i);d[i].p(old+i*od,otd)}for(var i=0;i<52;i++)u[i]=new Card(i);function gi(a){return document.getElementById(a)}function gc(a){return document.getElementsByClassName(a)}function gs(a){return gi(a).style}function ptg(){for(var i=0;i<p[pt].ac;i++){if(u[p[pt].a[i]].i==0){for(var j=0;j<4;j++){if(d[j].n==0&&d[j].t==12&&u[p[pt].a[i]].s==d[j].s&&(cs==0||cs==2)){cs=2;return cc(p[pt].a[i])};if(d[j].n==0&&d[j].b==1&&u[p[pt].a[i]].s==d[j].s&&(cs==0||cs==1)){cs=1;return cc(p[pt].a[i])}}}};for(var i=0;i<4;i++){if(d[i].n<1){for(var j=0;j<p[pt].ac;j++){var tr=u[p[pt].a[j]].i;if(tr==0&&cs==2)tr=13;if(d[i].t>=0&&d[i].s==u[p[pt].a[j]].s&&(d[i].t+1)==tr)return cc(p[pt].a[j])}}};for(var i=0;i<4;i++){if(d[i].n<1){for(var j=0;j<p[pt].ac;j++){var tr=u[p[pt].a[j]].i;if(tr==0&&cs==2)tr=13;if(d[i].b>=0&&d[i].s==u[p[pt].a[j]].s&&(d[i].b-1)==tr)return cc(p[pt].a[j])}}};for(var i=0;i<p[pt].ac;i++){if(u[p[pt].a[i]].i==6)return cc(p[pt].a[i])};var tm=u[p[pt].a[0]].ci;var di=0;for(var i=0;i<p[pt].ac;i++){if(u[p[pt].a[i]].ci==-1)return cc(p[pt].a[i]);if(u[p[pt].a[i]].ci<tm){di=i;tm=u[p[pt].a[i]].ci}}cc(p[pt].a[di])}function eg(){shint("Game is over.");for(var i=0;i<4;i++){p[i].sc=0;for(var j=0;j<p[i].dc;j++){u[p[i].d[j]].v=1;u[p[i].d[j]].d();p[i].sc+=(u[p[i].d[j]].i==0&&cs==2)?14:u[p[i].d[j]].i+1}}var t=new Array(0,1,2,3,4);for(var i=0;i<3;i++){for(var j=i+1;j<4;j++){if(p[t[i]].sc>p[t[j]].sc){var tm=t[i];t[i]=t[j];t[j]=tm}}}var s=0;var h='<table width="280"><tr><th width="50">Pos.</th><th width="130" align="left">Player</th><th width="100">Dead Score</th></tr>';for(var i=0;i<4;i++){if(t[i]==0)s=i;h+='<tr><td align="center">'+(i+1)+'.</td><td>'+p[t[i]].id+'</td><td align="center">'+p[t[i]].sc+'</td></tr>'}h+="</table>";gi("trs").innerHTML=h;sdlg('rs',300,220);var r=gl('p'+s);r=(r==null?1:(parseInt(r)==NaN?1:parseInt(r)+1));sl('p'+s,r)}function cp(a){for(var i=0;i<4;i++){for(var j=0;j<p[i].ac;j++){if(a==p[i].a[j])return i}}}function sp(a){var b;var c;if(a==0){for(var i=0;i<p[0].ac;i++){b=u[p[0].a[i]];b.p(p[0].x1+i*oc+1,p[0].y1+1);b.d();b.c.style.zIndex=i}for(var i=0;i<p[0].dc;i++){b=u[p[0].d[i]];b.p(p[0].x2-oc*i-cw,p[0].y1+1);b.d();b.c.style.zIndex=p[0].ac+i}}else if(a==1){for(var i=0;i<p[1].ac;i++){b=u[p[1].a[i]];b.p(p[1].x1+1,p[1].y1+i*oc+1);b.h=1;b.d();b.c.style.zIndex=i}for(var i=0;i<p[1].dc;i++){b=u[p[1].d[i]];b.p(p[1].x1+1,p[1].y2-ch-i*oc);b.h=1;b.d();b.c.style.zIndex=p[1].ac+i}}else if(a==2){for(var i=0;i<p[2].ac;i++){b=u[p[2].a[i]];b.p(p[2].x2-cw-i*oc+1,p[2].y1+1);b.d();b.c.style.zIndex=i}for(var i=0;i<p[2].dc;i++){b=u[p[2].d[i]];b.p(p[2].x1+i*oc+1,p[2].y1+1);b.d();b.c.style.zIndex=p[2].ac+i}}else if(a==3){for(var i=0;i<p[3].ac;i++){b=u[p[3].a[i]];b.p(p[3].x1+1,p[3].y2-ch-i*oc+1);b.h=1;b.d();b.c.style.zIndex=i}for(var i=0;i<p[3].dc;i++){b=u[p[3].d[i]];b.p(p[3].x1+1,p[3].y1+i*oc+1);b.h=1;b.d();b.c.style.zIndex=p[3].ac+i}}}function cpl(a){for(var i=0;i<4;i++){if(d[i].n<1){for(var j=0;j<p[a].ac;j++){var tr=u[p[a].a[j]].i;if(tr==0&&(cs==0||cs==2))tr=13;if(d[i].t>=0&&d[i].s==u[p[a].a[j]].s&&(d[i].t+1)==tr)return true}}};for(var i=0;i<4;i++){if(d[i].n<1){for(var j=0;j<p[a].ac;j++){var tr=u[p[a].a[j]].i;if(tr==0&&cs==2)tr=13;if(d[i].b>=0&&d[i].s==u[p[a].a[j]].s&&(d[i].b-1)==tr)return true}}}for(var i=0;i<p[a].ac;i++){if(u[p[a].a[i]].i==6)return true}return false};function sst(){var st=new Array('st','nd','rd','th');var sc=new Array(0,0,0,0);var pt=0;for(var i=0;i<4;i++){var r=gl('p'+i);r=(r==null)?0:parseInt(r);sc[i]=(r==NaN)?0:r;pt+=sc[i]};var h='<br/><br/><table width="280" align="center"><tr><td width="160">Games played</td><td width="120" align="right">'+pt+'</td></tr>';for(var i=0;i<4;i++){var s=(pt>0)?Math.round(sc[i]/pt*100):0;h+='<tr><td>'+(i+1)+st[i]+' position</td><td align="right">'+sc[i]+' ('+s+'%)</td></tr>'};h+='</table>';gi('tst').innerHTML=h;sdlg('st',400,270)}function clr(){hd('hint');for(var i=0;i<4;i++){hds(d[i].c)}for(var i=0;i<52;i++){hds(u[i].c)}}function gpc(a){var r='';for(var i=0;i<p[a].ac;i++){if(cip(p[a].a[i]))r+=ai[u[p[a].a[i]].i]+as[u[p[a].a[i]].s]+','}return r}function cip(a){if(u[a].i==6)return true;for(var i=0;i<4;i++){var tr=(u[a].i==0&&(cs==0||cs==2))?13:u[a].i;if(d[i].n==0&&d[i].s==u[a].s&&tr==(d[i].t+1)){return true}var tr=(u[a].i==0&&(cs==0||cs==1))?0:u[a].i;if(d[i].n==0&&d[i].s==u[a].s&&tr==(d[i].b-1)){return true}}return false}function sg(){var r='sgd({"cs":'+cs+',"d":[';for(var i=0;i<4;i++){r+='{"id":"'+d[i].id+'","s":'+d[i].s+',"t":'+d[i].t+',"b":'+d[i].b+',"n":'+d[i].n+"}"+((i<3)?",":"")}r+='],"p":[';for(var i=0;i<4;i++){r+='{"id":"'+p[i].id+'","ac":'+p[i].ac+',"dc":'+p[i].dc+',"a":[';for(var j=0;j<p[i].ac;j++){r+='{"j":'+p[i].a[j]+'}'+((j<(p[i].ac-1))?",":"")}r+='],"d":[';for(var j=0;j<p[i].dc;j++){r+='{"j":'+p[i].d[j]+'}'+((j<(p[i].dc-1))?",":"")}r+=']}'+((i<3)?',':'')}r+=']})';sl('sgd',r);alert('Game saved.');gi('lg').className=''}function sgd(a){for(var i=0;i<4;i++){d[i].id=a.d[i].id;d[i].s=a.d[i].s;d[i].t=a.d[i].t;d[i].b=a.d[i].b;d[i].n=a.d[i].n;p[i].ac=a.p[i].ac;p[i].dc=a.p[i].dc;for(var j=0;j<p[i].ac;j++){p[i].a[j]=a.p[i].a[j].j;u[p[i].a[j]].k=0;u[p[i].a[j]].v=(i==0)?1:0;u[p[i].a[j]].e=1}for(var j=0;j<p[i].dc;j++){p[i].d[j]=a.p[i].d[j].j;u[p[i].d[j]].k=1;u[p[i].d[j]].v=(i==0)?1:0;u[p[i].d[j]].e=1}if(d[i].n>0){for(var k=1;k<4;k++){for(var j=0;j<p[k].ac;j++)if(u[p[k].a[j]].s==this.s){u[p[k].a[j]].ci=-1}}}}cs=a.cs}function lg(){var a=gl('sgd');if(a!=null&&a!=''){eval(a);cdlg('mn');dg();pt=0;z=gpc(pt);sfp();gs('p0').color='#ff0';shint("<b>It's your turn.</b><br/>",1,(z!='')?('Playable card(s): '+z):'There are no playable card. Choose a dead card.')}}function ng(){cdlg('mn');cs=0;for(var i=0;i<4;i++){p[i].clr();d[i].clr()}for(var i=0;i<52;i++){t[i]=i;u[i].v=1;u[i].ci=u[i].i==0?13:u[i].i;u[i].e=1;u[i].h=0;u[i].k=0;hds(u[i].c)}for(var i=0;i<52;i++){j=Math.floor(Math.random()*52);tm=t[j];t[j]=t[i];t[i]=tm}for(var i=0;i<4;i++){for(var j=0;j<13;j++){if(i>0)u[t[i*13+j]].v=0;p[i].apc(t[i*13+j]);if(t[i*13+j]==6)pt=i}}dg();sfp();gs('p'+pt).color='#ff0';if(pt==0){shint("<b>It's your turn.</b>",1,"Choose 7 Spade to start the game.",1)}else{shint("Waiting for "+p[pt].id);setTimeout("cc(6)",1000)}}function dg(){for(var i=0;i<4;i++){d[i].d();d[i].dc();vb('p'+i);vb('r'+i);sp(i)}for(var i=0;i<52;i++)u[i].c.className='crd'}function shc(a){gi('chint').innerHTML=ch0;if(a.checked){sh=1;sl('sh',1);gi('chint').innerHTML+='<div style="color:#fff;font-size:'+(hf-1)+'px">'+ch1+'</div>'}else{sh=0;sl('sh',0)}}function rsc(){omn='mn';cdlg('rs');clr();sdlg(omn);for(var i=0;i<4;i++){hd('p'+i);hd('r'+i)}}function sfp(){for(var i=0;i<4;i++){gs('p'+i).color='#fff'}}