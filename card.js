var cardIm=new Array(4);var cardBg=new Image();cardBg.src="i/b.png";for(i=0;i<4;i++){cardIm[i]=new Image();cardIm[i].src="i/"+i+".png"}function Card(a){this.s=Math.floor(a/13);this.i=a%13;this.ci=this.i==0?13:this.i;this.j=a;this.v=1;this.e=1;this.h=0;this.k=0;c=document.createElement('canvas');c.id=i;c.width=cw;c.height=ch;c.style.position='absolute';c.onclick=function(){if(pt==0){ci=a;cc(a)}};gi('body').appendChild(c);this.t=c.getContext("2d");this.c=c};Card.prototype.y=function(){hds(this.c)};Card.prototype.z=function(){vbs(this.c)};Card.prototype.p=function(a,b){this.c.style.left=a+'px';this.c.style.top=b+'px'};Card.prototype.d=function(){this.z();var t0=this.t;if(this.v==1){var a=new Array('black','black','red','red');var s0=this.s;var i0=this.i;t0.font=cf+'px Arial';rr(t0,0,0,cw,ch,5,true,this.e==1?'white':'#ccc');t0.drawImage(cardIm[s0],il,il,iw,ih);t0.drawImage(cardIm[s0],cw-il-iw,ch-il-ih,iw,ih);t0.fillStyle=a[s0];if(i0==9){if(this.h==0){t0.fillText(ai[i0],il-2,il*2+ih+7);t0.fillText(ai[i0],cw-il*2-7,ch-(il*2+ih))}else{t0.fillText(ai[i0],il*2+9,il*2+4);t0.fillText(ai[i0],cw-il*2-22,ch-il)}}else{if(this.h==0){t0.fillText(ai[i0],1+il,il*2+ih+7);t0.fillText(ai[i0],cw-il-8,ch-(il*2+ih))}else{t0.fillText(ai[i0],il*2+9,il*2+4);t0.fillText(ai[i0],cw-il*2-16,ch-il)}}}else{var p=t0.createPattern(cardBg,"repeat");rr(t0,0,0,cw,ch,5,true,p)}if(this.k==0){rr(t0,0,0,cw,ch,5,false,'black')}else{rr(t0,0,0,cw,ch,5,false,'red',2)}};function cc(a){if(cp(a)==pt){var di=-1;for(var i=0;i<4;i++){if(d[i].s==-1||d[i].s==u[a].s){di=i;break}}if(di>=0&&d[di].s>=0&&cs==0&&u[a].i==0){if(u[d[di].t].i==12&&u[d[di].b].i==1){return sdlg('cnf',300,200)}else if(u[d[di].b].i==1){cs=1}else if(u[d[di].t].i==12){cs=2}}if(cpl(pt)){var z;if(d[di].ps(a)){if(d[di].n>0){for(var i=6;i<=d[di].t;i++){var j=(i==13)?0:i;u[si2j(d[di].s,j)].e=0;u[si2j(d[di].s,j)].d()}for(var i=5;i>=d[di].b;i--){u[si2j(d[di].s,i)].e=0;u[si2j(d[di].s,i)].d()}}p[pt].rpc(a);sp(pt);d[di].dc();if((p[0].ac+p[1].ac+p[2].ac+p[3].ac)==0){setTimeout("eg()",2000)}else{pt=(pt<3)?pt+1:0;sfp();gs('p'+pt).color='#ff0';if(pt==0){z=gpc(pt);shint("<b>It's your turn.</b><br/>",1,(z!='')?('Choose one of playable card(s): '+z):'There are no playable card. Choose a dead card.')}else{shint("Waiting for "+p[pt].id);setTimeout("ptg()",1500)}}}else{if(d[0].s==-1){shint("<b>Wrong card!</b>",2,"Choose 7 Spade to start the game.")}else{shint("<b>Wrong card!</b> You have to choose playable card.",2,'Playable card(s): '+gpc(pt))}}}else{p[pt].adc(a);p[pt].rpc(a);sp(pt);if((p[0].ac+p[1].ac+p[2].ac+p[3].ac)==0){setTimeout("eg()",2000)}else{pt=(pt<3)?pt+1:0;sfp();gs('p'+pt).color='#ff0';if(pt==0){z=gpc(pt);shint("<b>It's your turn.</b><br/>",1,(z!='')?('Playable card(s): '+z):'There are no playable card. Choose a dead card.')}else{shint("Waiting for "+p[pt].id);setTimeout("ptg()",1500)}}}}}function si2j(a,b){return a*13+b}